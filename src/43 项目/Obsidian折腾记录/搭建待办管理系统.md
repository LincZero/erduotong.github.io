---
backlink: []
date: '2024-10-29'
isOriginal: true
outlink: []
title: 搭建待办管理系统
---
## 1.背景
作为一个All-in-one (~~All in Boom~~)的狂热爱好者，其他的Todo软件是不可能用的（例如Mircosoft Todo和滴答清单），这种东西自然要Obsidian解决。
不过Obsidian基于`Markdown`，自带的Todo很是简陋，循环/提醒等都没有。除了能写日记里面，其他的完全比不上那些专业的软件，需要很多时间整理。
因此，经过一段时间的使用，是时候搭建自己的任务管理系统了。
## 2.功能需求设计
- 快速添加，减少添加一个任务的心智成本
- 循环，通过每周、每月、每年、法定工作日、农历每年等重复规则，减少重复的成本
- 提醒，防止看着看着不记得东西了
- 开始和截止时间
## 3.定义格式
让我们先为我们的Todo定义一条格式吧。
为了兼容[Obsidian Reminder](https://github.com/uphy/obsidian-reminder)，我们的todo内容要放在一行。
所以我们的格式是:
```markdown
- [ ] (@yyyy-mm-dd hh:mm) ...
```
- 最开始，我们添加todo格式的列表，表明这是一个todo
- 然后，添加reminder格式的提醒日期
- 最后，添加我们想要的内容（当然，只能在一行内）
## 4.定时任务
### 定义
定义好格式，那么，我们先来搞定定时任务

一般来说，会有以下的几种格式:
- 每天
- 每周(选择几天)
- 每月(选择几天)
- 每年(选择哪几天)
- 自定义 (按指定xx天循环一次)
> [!note] 为什么不统一抽象成自定义，每隔7天/30天/365天进行一次?
> 有一些东西不是很好处理，例如闰年，这些如果单独加一个按年的循环，会方便很多

然后，考虑到有单双周存在，我们再加入一个循环间隔，可以指定每隔xx进行一次（例如，每隔两周，周三添加一个待办）

为此，让我们来规定一下格式吧
```markdown
- [type::(daily|yearly|monthly|weekly|custom)] [interval::int] [custom_long?:: int] [day::int] [indexDay::date] [time::time]content
```
- type: 指的是类型，提供一些预设
- interval: 两个循环之间的间隔，例如如果是连续的两周，那就是0，如果希望一周之后间隔一周再来，那么就是1
- custom_long: 自定义时长的单个循环节的长度，可选
- day: 包含哪些天来创建，例如一周可以选择1,2,3,4,5,6,7，也就是周一 -> 周日，使用的是逗号分隔。
- indexDay: 从哪天开始计算
- time: 提醒时间
- content: 待办的主体
### 实现


```js
const modalForm = app.plugins.plugins.modalforms.api;
const result = await modalForm.openForm("scheduled-task-creator");
const data = result.data;
let { type, interval, indexDay, time_boolean, content } = data;
if (interval < 0) {
  console.error("间隔必须大于等于0");
}
if (type === "custom" && !data.custom_long) {
  console.error("请输入自定义时间");
}
const is_day_custom_ok = () => {
  if (data.day_custom.length === 0) {
    console.error("自定日期不能为空！请重新按照提示选择");
    return false;
  }
  if (!data.day_custom) return false;
  for (item of data.day_custom) {
    if (isNaN(item)) {
      return false;
    }
    if (item < 1 || item > data.custom_long) {
      return false;
    }
  }
  return true;
};
if (type === "custom" && is_day_custom_ok() === false) {
  console.error("自定日期内选择错误！请重新按照提示选择");
}
if (!indexDay) {
  const date = new Date();
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, "0");
  const day = String(date.getDate()).padStart(2, "0");
  indexDay = `${year}-${month}-${day}`;
}
const handlers = {
  daily: () => {
    return true;
  },
  weekly: () => {
    return data.day_weekly;
  },
  monthly: () => {
    return data.day_monthly;
  },
  yearly: () => {
    return data.day_yearly;
  },
  custom: () => {
    return data.day_custom;
  },
};
const time = time_boolean ? `[time::${data.time}]` : "";
const custom_long = type === "custom" ? `[custom_long::${data.custom_long}]` : "";
return `- [type::${type}] [interval::${interval}] [day::${handlers[type]()}] ${time} ${custom_long} [indexDay::${indexDay}] ${content}`;
```
### 生成
然后，我们需要想办法让这个定时系统能够被解析出来并且放到我们的日记里面。


